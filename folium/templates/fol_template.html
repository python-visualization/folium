<!DOCTYPE html>
<head>
   <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
   <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

   <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
   <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
   <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

   <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.0/leaflet.awesome-markers.css">
   <script src="//cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.0/leaflet.awesome-markers.js"></script>


   <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.Default.css">
   <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.css">
   <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster-src.js"></script>
   <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js"></script>

   

   {{ dvf_js }}
   {{ d3 }}
   {{ vega }}
   {{ jquery }}


   <style>

      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        position:absolute;
        top:0;
        bottom:0;
        right:0;
        left:0;
      }

   </style>
</head>

<body>

   <div class="folium-map" id="{{ map_id }}" {{ size }}></div>

   <script>

      {{ vega_parse }}

      var map = L.map('{{ map_id }}').setView([{{ lat }}, {{ lon }}], {{ zoom_level }});

      L.tileLayer('{{ Tiles }}', {
          maxZoom: {{ max_zoom }},
          attribution: '{{ attr }}'
      }).addTo(map);

      //cluster group
      var clusteredmarkers = L.markerClusterGroup();
      //section for adding clustered markers
      {% for icon, mark, popup, add_mark in cluster_markers %}
      {{ icon }}
      {{ mark }}
      {{ popup }}
      {{ add_mark }}
      {% endfor %}
      //add the clustered markers to the group anyway
      map.addLayer(clusteredmarkers);

      {% for icon, mark, popup, add_mark in custom_markers %}
      {{ icon }}
      {{ mark }}
      {{ popup }}
      {{ add_mark }}
      {% endfor %}

      {% for mark, popup, add_mark in markers %}
      {{ mark }}
      {{ popup }}
      {{ add_mark }}
      {% endfor %}

      {% for line, add_line in lines %}
      {{ line }}
      {{ add_line }}
      {% endfor %}

      {{ lat_lng_pop }}

      {{ click_pop }}

   </script>

</body>
